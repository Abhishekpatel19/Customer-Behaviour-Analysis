select * from customer limit 20
-- time for questions
-- 1. what is the total revenue generated by male vs female
select gender, Sum(purchase_amount) as revenue 
from customer 
group by gender

-- 2. Which customer used a discount but spent more than average purchase amount?
select customer_id, purchase_amount
from customer
where discount_applied = 'Yes' and
purchase_amount <= (select AVG(purchase_amount) from customer)

-- 3. What are the 5 products with highest review rating
select item_purchased , ROUND(AVG(review_rating::numeric),2) as product_review_rating
from customer
group by item_purchased
order by avg (review_rating )desc
limit 5

-- 4. compare the avg purchase amount btw standard and express shipping
select shipping_type,
ROUND(AVG(purchase_amount),2)
from customer
where shipping_type in('Standard' , 'Express')
group by shipping_type

-- 5. DO subscribed customer spend more? compare avg spend and total revenue 
-- between subscribed and non- subscribed customers?
select subscription_status,
Round(AVG(purchase_amount),2) as avg_spend,
Round(SUM(purchase_amount),2) as total_revenue
from customer
group by subscription_status
order by avg_spend , total_revenue desc

-- 6. which 5 products has the highest amount of purchases with discount applied
select item_purchased ,
ROUND(100.0 * SUM(CASE WHEN discount_applied = 'Yes' THEN 1 ELSE 0 END)/ count(*),2) as discount_rate
from customer
group by item_purchased
order by discount_rate desc
limit 5;

-- 7. segment customers into new , returning,  loyal based on previous purchase
--  and return the count of each segment

with customer_type as (
select customer_id, previous_purchases,
CASE 
     WHEN previous_purchases = 1 THEN 'NEW'
	 WHEN previous_purchases BETWEEN 2 AND 10 THEN 'RETURNING'
	 else 'LOYAL'  END as customer_segment
from customer

)
select customer_segment,
count (*) as "number of customers"
from customer_type
group by customer_segment

-- 8. what are 3 most purchased producst within each category

with item_counts as (
select category,
item_purchased,
count(customer_id) as total_orders,
ROW_NUMBER() over(partition by category order by count (customer_id) desc) as item_rank
from customer
group by category,item_purchased

)
select category,item_purchased, item_rank, total_orders
from item_counts
where item_rank<=3;


-- 9. Are customers who are repeat(mpre than 5) buyers also subscribers?
select subscription_status,
count(customer_id) as repeat_buyers
from customer
where previous_purchases > 5
group by subscription_status;

-- 10. what is the revenue contribution by age group
select age_group,
SUM(purchase_amount) as total_revenue
from customer
group by age_group
order by total_revenue desc







